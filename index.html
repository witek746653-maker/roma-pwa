<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ ‚Äî –∫–æ–º–ø–∞–∫—Ç</title>
<style>
  :root{ --bg:#fff; --text:#0f172a; --muted:#64748b; --border:#e5e7eb; --panel:#f8fafc }
  *{box-sizing:border-box; -webkit-tap-highlight-color:transparent}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font:12px/1.25 system-ui,-apple-system,Segoe UI,Roboto}
  /* –®–∞–ø–∫–∞ */
  .header{position:sticky;top:0;z-index:10;display:grid;grid-template-columns:1fr;gap:6px;padding:6px;border-bottom:1px solid var(--border);background:#fff}
  .left{display:flex;flex-wrap:wrap;gap:6px;align-items:center}
  label{font-size:10px;color:var(--muted)}
  .field{display:flex;gap:2px;flex-direction:column}
  input[type="date"],button{border:1px solid var(--border);background:#fff;border-radius:8px;min-height:28px;padding:4px 8px;font-size:12px}
  button{cursor:pointer}
  .btn-acc{border-color:#c7d2fe}
  /* –ü–∞–Ω–µ–ª—å –æ—Ñ–∏—Ü–∏–∞–Ω—Ç–æ–≤ (–≤ 2 —Ä–∞–∑–∞ –º–µ–Ω—å—à–µ) */
  .waiters{display:grid;grid-auto-flow:column;grid-template-rows:repeat(2,auto);gap:4px 6px;overflow-x:auto;padding:2px 0}
  .chip{border:1px solid #c7d2fe;border-radius:999px;padding:4px 8px;background:#eef2ff;color:#0b1e4a;display:inline-flex;gap:6px;align-items:center}
  .chip .name{font-weight:800;font-size:12px}
  .chip .note-dot{font-size:10px;color:#475569}
  .chip .edit{border:1px solid var(--border);border-radius:6px;padding:1px 5px;background:#fff;font-size:11px}
  .chip .del{border:none;background:none;color:#991b1b;font-weight:900;font-size:14px;line-height:1;padding:0 4px}
  .chip.active{outline:2px solid rgba(99,102,241,.25)}
  /* –°–µ—Ç–∫–∞ 3 –∫–æ–ª–æ–Ω–∫–∏ –¥–∞–∂–µ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ */
  .columns{display:grid;gap:6px;padding:6px;grid-template-columns:repeat(3,1fr)}
  details.panel{background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:6px}
  summary{list-style:none;display:flex;gap:6px;align-items:center;cursor:pointer}
  summary::-webkit-details-marker{display:none}
  .hall-title{font-weight:900;font-size:12px}
  .pos-grid{display:grid;gap:6px;margin-top:6px}
  .pos-card{background:#fff;border:1px solid var(--border);border-radius:10px;padding:6px;display:flex;flex-direction:column;gap:6px}
  .pos-head{display:flex;gap:6px;align-items:center}
  .pos-title{font-weight:800;font-size:12px}
  .counter{margin-left:auto;color:#475569;font-size:11px}
  .slot{display:flex;flex-wrap:wrap;gap:4px;border:1px dashed #e2e8f0;border-radius:8px;padding:6px;min-height:32px}
  /* –ò–º—è –≤–Ω—É—Ç—Ä–∏ –∑–æ–Ω—ã ‚Äî –±–µ–∑ –∫—Ä—É–∂–∫–∞, —Ü–≤–µ—Ç –∫–∞–∫ —É –∫–Ω–æ–ø–∫–∏ */
  .assign{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--border);border-radius:999px;padding:3px 8px;background:#fafafa}
  .assign .w-name{font-weight:800;font-size:12px}
  .assign .w-note{font-size:10px;color:#64748b}
  .assign .x{border:none;background:none;color:#991b1b;font-weight:900;font-size:14px;line-height:1;cursor:pointer;padding:0}
  /* –î—Ä–æ–ø–¥–∞—É–Ω –≤—ã–±–æ—Ä–∞ –∏–º–µ–Ω–∏ –≤ –∫–∞–∂–¥–æ–π –∑–æ–Ω–µ */
  .adder{display:flex;gap:6px;align-items:center}
  .adder select{border:1px solid var(--border);border-radius:8px;min-height:26px;padding:2px 6px;font-size:12px;max-width:100%}
  .adder .addBtn{border:1px solid #c7d2fe;background:#eef2ff;border-radius:8px;min-height:26px;padding:2px 8px;font-size:12px;cursor:pointer}
  /* –û—á–µ–Ω—å –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ä–µ–∂–∏–º, —á—Ç–æ–±—ã –≤—Å—ë –≤–ª–µ–∑–ª–æ */
  @media (max-width:430px){
    html,body{font-size:11px}
    input[type="date"],button{min-height:26px;font-size:11px}
    .chip .name,.assign .w-name{font-size:11px}
    .columns{gap:4px}
    .pos-card{padding:6px}
    .slot{padding:4px}
  }
</style>
</head>
<body>
  <div class="header">
    <div class="left">
      <div class="field">
        <label for="date">–î–∞—Ç–∞</label>
        <input id="date" type="date" />
      </div>
      <button id="addWaiter" class="btn-acc">–î–æ–±–∞–≤–∏—Ç—å –æ—Ñ–∏—Ü–∏–∞–Ω—Ç–∞</button>
      <button id="share" class="btn-acc">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
      <button id="copy">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
      <button id="resetDay">–û—á–∏—Å—Ç–∏—Ç—å</button>
      <button id="hardReset" title="–ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</button>
    </div>
    <div class="waiters" id="waiterRow" aria-label="–û—Ñ–∏—Ü–∏–∞–Ω—Ç—ã"></div>
  </div>

  <div class="columns">
    <div class="col" id="col1"></div>
    <div class="col" id="col2"></div>
    <div class="col" id="col3"></div>
  </div>

  <!-- —à–∞–±–ª–æ–Ω—ã -->
  <template id="chipTpl">
    <div class="chip" tabindex="0">
      <span class="name"></span>
      <span class="note-dot"></span>
      <button class="edit" title="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏">üí¨</button>
      <button class="del" title="–£–¥–∞–ª–∏—Ç—å –æ—Ñ–∏—Ü–∏–∞–Ω—Ç–∞">√ó</button>
    </div>
  </template>

  <template id="hallTpl">
    <details class="panel" open>
      <summary><span class="hall-title"></span></summary>
      <div class="pos-grid"></div>
    </details>
  </template>

  <template id="posCardTpl">
    <div class="pos-card">
      <div class="pos-head">
        <div class="pos-title"></div>
        <div class="counter"></div>
      </div>
      <div class="adder">
        <select class="pick"><option value="">‚Äî –≤—ã–±—Ä–∞—Ç—å –æ—Ñ–∏—Ü–∏–∞–Ω—Ç–∞ ‚Äî</option></select>
        <button class="addBtn">–î–æ–±–∞–≤–∏—Ç—å</button>
      </div>
      <div class="slot"></div>
    </div>
  </template>

<script>
'use strict';
/* ====== –î–ê–ù–ù–´–ï ====== */
const UUID=(crypto&&crypto.randomUUID)?()=>crypto.randomUUID():()=>('id-'+Math.random().toString(36).slice(2));
const STORAGE_KEY='rota-compact-v1';
const CHIP_COLORS=[['#E3F2FD','#0b1e4a'],['#FCE7F3','#3e1a36'],['#E8F5E9','#103b1f'],['#FFF3E0','#4a2f0b'],['#F3E8FF','#2e1065'],['#E0F2F1','#083d3b'],['#FFFDE7','#3a3000'],['#F1F5F9','#0f172a'],['#FFE4E6','#4a0b15'],['#EDE7F6','#1f1147']];
const CANON_HALLS=[
  {name:'–û—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ª', positions:['–ó–æ–Ω–∞ –æ–∫–Ω–∞','5-—è –ª–∏–Ω–∏—è','–°—Ç–æ–ª—ã 7, 8, 9','–°—Ç–æ–ª—ã 10, 11, 12','–ü–æ–¥–∏—É–º']},
  {name:'–ú–∞–ª—ã–π (–±–∞–Ω–∫–µ—Ç–Ω—ã–π) –∑–∞–ª', positions:['–ú–ë–ó']},
  {name:'–í–ò–ü-–∫–æ–º–Ω–∞—Ç—ã', positions:['–ë–æ–ª—å—à–æ–π –í–ò–ü','–ú–∞–ª—ã–π –í–ò–ü','–ö–∞—é—Ç–∞','–õ–∏–µ–Ω–¥–∞']},
  {name:'–í–µ—Ä–∞–Ω–¥–∞', positions:['–í–µ—Ä–∞–Ω–¥–∞ 1','–í–µ—Ä–∞–Ω–¥–∞ 2']},
  {name:'–õ–æ—Ñ—Ç', positions:['–õ–æ—Ñ—Ç']},
  {name:'–í–∏–Ω–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞', positions:['–í–∏–Ω–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞']}
];
function buildDB(){
  return {
    halls: CANON_HALLS.map(h=>({id:UUID(),name:h.name,positions:h.positions.map(n=>({id:UUID(),name:n}))})),
    waiters:['–ò–≥–æ—Ä—å','–í–∏–∫—Ç–æ—Ä','–†–æ–º–∞–Ω','–≠–ª–æ–Ω–∞','–ü–æ–ª–∏–Ω–∞','–ö—Å–µ–Ω–∏—è','–ù–∞—Ç–∞–ª—å—è –ß.','–ù–∞—Ç–∞–ª—å—è –í.','–ê–Ω–∞—Å—Ç–∞—Å–∏—è','–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞'].map(n=>({id:UUID(),name:n})),
    assignments:{}, notes:{}
  };
}
function load(){ try{return JSON.parse(localStorage.getItem(STORAGE_KEY));}catch{return null;} }
function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(db)); }
let db = load() || buildDB();

/* ====== –£–¢–ò–õ–´ ====== */
const dateEl=document.getElementById('date');
function todayISO(){const tz=(new Date()).getTimezoneOffset()*60000; return new Date(Date.now()-tz).toISOString().slice(0,10);}
function dateKey(){return dateEl.value || todayISO();}
function getDay(){const k=dateKey(); if(!db.assignments[k]) db.assignments[k]={}; return db.assignments[k];}
function ensureSlot(hid,pid){const day=getDay(); if(!day[hid]) day[hid]={}; if(!Array.isArray(day[hid][pid])) day[hid][pid]=[]; return day[hid][pid];}
function waiterById(id){return db.waiters.find(w=>w.id===id)}
function colorForWaiter(id){const i=Math.max(0, db.waiters.findIndex(w=>w.id===id)); const [bg,fg]=CHIP_COLORS[i%CHIP_COLORS.length]; return {bg,fg}}
function notesForDay(){const k=dateKey(); if(!db.notes[k]) db.notes[k]={}; return db.notes[k];}
function getNotes(wid){const m=notesForDay(); return m[wid]||(m[wid]=[])}
function addNote(wid,t){const a=getNotes(wid); if(!a.includes(t)) a.push(t); save()}
function delNote(wid,i){const a=getNotes(wid); a.splice(i,1); save()}

/* ====== –®–ê–ü–ö–ê: –æ—Ñ–∏–∫–∏ ====== */
const chipTpl=document.getElementById('chipTpl');
const waiterRow=document.getElementById('waiterRow');
let selected=null;

function renderWaiters(){
  waiterRow.innerHTML='';
  db.waiters.forEach(w=>{
    const chip=chipTpl.content.firstElementChild.cloneNode(true);
    chip.querySelector('.name').textContent=w.name;
    chip.querySelector('.note-dot').textContent=getNotes(w.id).length?'‚Ä¢':'';
    const {bg,fg}=colorForWaiter(w.id);
    chip.style.background=bg; chip.style.color=fg; chip.style.borderColor=bg;
    if(selected && selected===w.id) chip.classList.add('active');

    chip.addEventListener('click',e=>{
      if(e.target.closest('.edit')||e.target.closest('.del')) return;
      selected = (selected===w.id)? null : w.id;
      renderWaiters();
    },{passive:true});

    chip.querySelector('.edit').addEventListener('click',e=>{
      e.stopPropagation();
      openCommentsModal(w.id, w.name);
    });
    chip.querySelector('.del').addEventListener('click',e=>{
      e.stopPropagation();
      if(confirm(`–£–¥–∞–ª–∏—Ç—å ¬´${w.name}¬ª?`)){
        // —É–±—Ä–∞—Ç—å –∏–∑ –≤—Å–µ—Ö –∑–æ–Ω
        for(const day in db.assignments){
          const halls=db.assignments[day];
          for(const hid in halls){ for(const pid in halls[hid]){ halls[hid][pid] = (halls[hid][pid]||[]).filter(x=>x!==w.id); } }
        }
        db.waiters = db.waiters.filter(x=>x.id!==w.id);
        if(db.notes) for(const d in db.notes){ delete (db.notes[d]||{})[w.id]; }
        if(selected===w.id) selected=null;
        save(); renderWaiters(); renderColumns();
      }
    });

    waiterRow.appendChild(chip);
  });
}

/* ====== –ö–û–õ–û–ù–ö–ò ====== */
const hallTpl=document.getElementById('hallTpl'), posCardTpl=document.getElementById('posCardTpl');
const col1=document.getElementById('col1'), col2=document.getElementById('col2'), col3=document.getElementById('col3');

function renderColumns(){
  col1.innerHTML=''; col2.innerHTML=''; col3.innerHTML='';
  const order=['–û—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ª','–ú–∞–ª—ã–π (–±–∞–Ω–∫–µ—Ç–Ω—ã–π) –∑–∞–ª','–í–ò–ü-–∫–æ–º–Ω–∞—Ç—ã','–í–µ—Ä–∞–Ω–¥–∞','–õ–æ—Ñ—Ç','–í–∏–Ω–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞'];
  const byName=Object.fromEntries(db.halls.map(h=>[h.name,h]));

  function mount(h,into){
    const sec=hallTpl.content.firstElementChild.cloneNode(true);
    sec.querySelector('.hall-title').textContent=h.name;
    const grid=sec.querySelector('.pos-grid');

    h.positions.forEach(p=>{
      const card=posCardTpl.content.firstElementChild.cloneNode(true);
      card.querySelector('.pos-title').textContent=p.name;
      const counter=card.querySelector('.counter');
      const slot=card.querySelector('.slot');
      const pick=card.querySelector('.pick');
      const addBtn=card.querySelector('.addBtn');

      // –∑–∞–ø–æ–ª–Ω–∏—Ç—å –¥—Ä–æ–ø–¥–∞—É–Ω –≤—Å–µ–º–∏ –æ—Ñ–∏—Ü–∏–∞–Ω—Ç–∞–º–∏
      pick.innerHTML='<option value="">‚Äî –≤—ã–±—Ä–∞—Ç—å –æ—Ñ–∏—Ü–∏–∞–Ω—Ç–∞ ‚Äî</option>';
      db.waiters.forEach(w=>{
        const opt=document.createElement('option'); opt.value=w.id; opt.textContent=w.name; pick.appendChild(opt);
      });

      const draw=()=>{
        const arr=ensureSlot(h.id,p.id);
        slot.innerHTML='';
        arr.forEach(wid=>{
          const w=waiterById(wid); if(!w) return;
          const {bg,fg}=colorForWaiter(wid);
          const el=document.createElement('div'); el.className='assign'; el.style.background=bg; el.style.color=fg; el.style.borderColor=bg;
          const nm=document.createElement('div'); nm.className='w-name'; nm.textContent=w.name;
          const noteTxt=getNotes(wid); if(noteTxt.length){ const nt=document.createElement('div'); nt.className='w-note'; nt.textContent=noteTxt.join(', '); el.appendChild(nt); }
          const x=document.createElement('button'); x.className='x'; x.title='–£–±—Ä–∞—Ç—å'; x.textContent='√ó';
          x.onclick=(e)=>{ e.stopPropagation(); removeFrom(h.id,p.id,wid); draw(); };
          el.appendChild(nm); el.appendChild(x);
          slot.appendChild(el);
        });
        counter.textContent=String(arr.length); // —Ç–æ–ª—å–∫–æ —Å—á—ë—Ç—á–∏–∫, –±–µ–∑ –ª–∏–º–∏—Ç–∞
      };

      function addTo(hid,pid,wid){
        if(!wid) return;
        const arr=ensureSlot(hid,pid);
        if(arr.includes(wid)) return;
        if(arr.length>=3){ alert('–ú–∞–∫—Å–∏–º—É–º 3 –∏–º–µ–Ω–∏ –≤ —ç—Ç–æ–π –∑–æ–Ω–µ.'); return; } // –≤–∏–∑—É–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç 3
        arr.push(wid); save(); draw();
      }
      function removeFrom(hid,pid,wid){
        const arr=ensureSlot(hid,pid); const i=arr.indexOf(wid); if(i>-1) arr.splice(i,1); save();
      }

      // –ö–ª–∏–∫ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–µ ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤ —à–∞–ø–∫–µ
      card.addEventListener('click',e=>{
        if(e.target.closest('.adder')||e.target.closest('.assign')) return;
        if(selected) addTo(h.id,p.id,selected);
      });
      // –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å" –∏–∑ –¥—Ä–æ–ø–¥–∞—É–Ω–∞
      addBtn.addEventListener('click',e=>{
        e.stopPropagation();
        const wid=pick.value; addTo(h.id,p.id,wid); pick.value='';
      });

      draw();
      grid.appendChild(card);
    });

    into.appendChild(sec);
  }

  order.forEach((n,i)=>{
    const h=byName[n]; if(!h) return;
    if(i<2) mount(h,col1);
    else if(i===2) mount(h,col2);
    else mount(h,col3);
  });
}

/* ====== –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –æ—Ñ–∏—Ü–∏–∞–Ω—Ç—É ====== */
function openCommentsModal(wid, wname){
  const presets=['–ü–æ–º–æ—â—å –Ω–∞ –≤–µ—Ä–∞–Ω–¥–µ 1','–ü–æ–º–æ—â—å –Ω–∞ –≤–µ—Ä–∞–Ω–¥–µ 2','–ü–æ–º–æ—â—å –≤ –û–ó','–ü–æ–º–æ—â—å –Ω–∞ –í–ò–ü–∞—Ö','–ü–æ–º–æ—â—å –≤ –ú–ë–ó','–ü–µ—Ä–≤—ã–π –Ω–æ–º–µ—Ä –Ω–∞ –±–∞–Ω–∫–µ—Ç–µ','–í—Ç–æ—Ä–æ–π –Ω–æ–º–µ—Ä –Ω–∞ –±–∞–Ω–∫–µ—Ç–µ'];
  const wrap=document.createElement('div'); wrap.style.position='fixed'; wrap.style.inset='0'; wrap.style.background='rgba(0,0,0,.25)';
  wrap.style.display='flex'; wrap.style.alignItems='center'; wrap.style.justifyContent='center'; wrap.style.padding='10px'; wrap.innerHTML =
    '<div style="background:#fff;border:1px solid #e5e7eb;border-radius:10px;padding:10px;min-width:min(96vw,420px)">' +
      '<div style="font-weight:900;margin-bottom:6px">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ‚Äî '+wname+'</div>'+
      '<div id="presetBox" style="display:flex;flex-wrap:wrap;gap:6px;margin-bottom:6px"></div>'+
      '<div id="tagList" style="display:flex;flex-wrap:wrap;gap:6px;margin-bottom:6px"></div>'+
      '<div style="display:flex;gap:6px"><input id="cInp" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: –¥–æ 18:00" style="flex:1;border:1px solid #e5e7eb;border-radius:8px;padding:6px 8px"/><button id="cAdd" class="btn-acc">–î–æ–±–∞–≤–∏—Ç—å</button><button id="cClose">–ó–∞–∫—Ä—ã—Ç—å</button></div>'+
    '</div>';
  document.body.appendChild(wrap);

  const box=wrap.querySelector('#presetBox'), list=wrap.querySelector('#tagList'), inp=wrap.querySelector('#cInp');
  function redraw(){
    list.innerHTML='';
    getNotes(wid).forEach((t,i)=>{
      const tag=document.createElement('span');
      tag.style.cssText='font-size:11px;background:#eef2ff;border:1px solid #c7d2fe;border-radius:999px;padding:2px 8px;display:inline-flex;align-items:center;gap:6px';
      const x=document.createElement('b'); x.textContent='√ó'; x.style.cssText='cursor:pointer;color:#991b1b';
      x.onclick=()=>{ delNote(wid,i); redraw(); renderColumns(); renderWaiters(); };
      tag.appendChild(document.createTextNode(t)); tag.appendChild(x); list.appendChild(tag);
    });
  }
  presets.forEach(p=>{
    const b=document.createElement('button'); b.textContent=p; b.className='btn-acc'; b.style.cssText='border:1px dashed #cbd5e1;border-radius:999px;padding:4px 8px;background:#fff;font-size:11px';
    b.onclick=()=>{ const cur=getNotes(wid); const i=cur.indexOf(p); if(i===-1) addNote(wid,p); else delNote(wid,i); redraw(); renderColumns(); renderWaiters(); };
    box.appendChild(b);
  });
  wrap.querySelector('#cAdd').onclick=()=>{ const v=(inp.value||'').trim(); if(!v) return; addNote(wid,v); inp.value=''; redraw(); renderColumns(); renderWaiters(); };
  wrap.querySelector('#cClose').onclick=()=>wrap.remove();
  wrap.addEventListener('click',e=>{ if(e.target===wrap) wrap.remove(); });
  redraw();
}

/* ====== –í–µ—Ä—Ö–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ ====== */
document.getElementById('addWaiter').onclick=()=>{
  const name=prompt('–ò–º—è –æ—Ñ–∏—Ü–∏–∞–Ω—Ç–∞'); if(!name) return;
  if(db.waiters.some(w=>w.name.toLowerCase()===name.trim().toLowerCase())) return alert('–¢–∞–∫–æ–µ –∏–º—è —É–∂–µ –µ—Å—Ç—å.');
  db.waiters.push({id:UUID(),name:name.trim()}); save(); renderWaiters();
};
document.getElementById('copy').onclick=async()=>{
  const txt=exportText(); try{ await navigator.clipboard.writeText(txt); alert('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ'); }catch(e){ alert('–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é:\n\n'+txt); }
};
document.getElementById('share').onclick=async()=>{
  const text=exportText(); try{ if(navigator.share){ await navigator.share({title:'–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ',text}); } else { await navigator.clipboard.writeText(text); alert('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ'); } }catch{}
};
document.getElementById('resetDay').onclick=()=>{
  if(!confirm('–û—á–∏—Å—Ç–∏—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ —ç—Ç—É –¥–∞—Ç—É?')) return;
  const k=dateKey(); db.assignments[k]={}; db.notes[k]={}; save(); renderColumns(); renderWaiters();
};
document.getElementById('hardReset').onclick=()=>{
  if(!confirm('–ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö?')) return;
  localStorage.removeItem(STORAGE_KEY); location.reload();
};
document.getElementById('date').onchange=()=>{ renderColumns(); renderWaiters(); };

/* ====== –≠–∫—Å–ø–æ—Ä—Ç ====== */
function exportText(){
  const d=dateKey(); const lines=['–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ '+d];
  const day=getDay();
  db.halls.forEach(h=>{
    lines.push('\n'+h.name+':');
    h.positions.forEach(p=>{
      const arr=(day[h.id]&&day[h.id][p.id])||[];
      const names=arr.map(id=>waiterById(id)?.name||'‚Äî').join(' | ') || '‚Äî';
      lines.push('‚Ä¢ '+p.name+': '+names+'  ('+arr.length+')');
    });
  });
  return lines.join('\n');
}

/* ====== –°—Ç–∞—Ä—Ç ====== */
function renderAll(){ renderWaiters(); renderColumns(); }
dateEl.value = todayISO();
renderAll();
</script>
</body>
</html>
